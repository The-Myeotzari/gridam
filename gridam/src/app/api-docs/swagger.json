{
  "openapi": "3.0.0",
  "info": {
    "title": "Gridam API",
    "version": "1.0.0",
    "description": "gridam API"
  },
  "servers": [{ "url": "/apis", "description": "Next.js App Router API base (ë¡œì»¬/ë°°í¬ ê³µí†µ)" }],
  "tags": [
    {
      "name": "Drafts",
      "description": "ì„ì‹œì €ì¥(Drafts) CRUD ë° ê²Œì‹œ(publish) API. ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ëŠ” **ë¡œê·¸ì¸ ì‚¬ìš©ì ì „ìš©**ì´ë©°, Authorization í—¤ë”ë¡œ Supabase access_token(JWT)ì„ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤."
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Supabase access_token"
      }
    },
    "schemas": {
      "SuccessEnvelope": {
        "type": "object",
        "properties": {
          "ok": { "type": "boolean", "example": true },
          "message": { "type": "string", "example": "ok" },
          "data": {}
        },
        "required": ["ok", "message"]
      },
      "ErrorEnvelope": {
        "type": "object",
        "properties": {
          "ok": { "type": "boolean", "example": false },
          "message": { "type": "string", "example": "VALIDATION_ERROR" },
          "details": { "type": "object", "nullable": true }
        },
        "required": ["ok", "message"]
      },
      "Draft": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "7f9c7a87-bb69-4e35-8baf-1b6b0eac3e50"
          },
          "user_id": { "type": "string", "format": "uuid" },
          "content": { "type": "string", "maxLength": 200 },
          "image_url": { "type": "string", "nullable": true, "example": "images/<uid>/canvas.png" },
          "emoji": { "type": "string", "nullable": true, "example": "ğŸ™‚" },
          "status": { "type": "string", "enum": ["draft", "published"], "example": "draft" },
          "date": { "type": "string", "format": "date", "example": "2025-11-07" },
          "published_at": { "type": "string", "format": "date-time", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" },
          "deleted_at": { "type": "string", "format": "date-time", "nullable": true }
        },
        "required": ["id", "user_id", "content", "status", "date", "created_at"]
      },
      "DraftCreate": {
        "type": "object",
        "required": ["content", "date"],
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "example": "ì˜¤ëŠ˜ì€ í•´ê°€ ì¨ì¨ ğŸŒ"
          },
          "image": {
            "type": "string",
            "nullable": true,
            "description": "storage object path",
            "example": "images/<uid>/canvas.png"
          },
          "emoji": { "type": "string", "nullable": true, "example": "ğŸŒ" },
          "date": {
            "type": "string",
            "format": "date",
            "description": "YYYY-MM-DD",
            "example": "2025-11-07"
          }
        }
      },
      "DraftUpdate": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "example": "ìˆ˜ì •ë³¸ ë‚´ìš©"
          },
          "image": { "type": "string", "nullable": true, "example": "images/<uid>/new.png" },
          "emoji": { "type": "string", "nullable": true, "example": "âœ¨" }
        },
        "additionalProperties": false
      },
      "PublishResult": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "status": { "type": "string", "enum": ["published"], "example": "published" },
          "published_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-07T09:05:00.000Z"
          },
          "date": { "type": "string", "format": "date", "example": "2025-11-07" }
        },
        "required": ["id", "status", "published_at", "date"]
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/drafts": {
      "post": {
        "tags": ["Drafts"],
        "summary": "Create a draft diary",
        "description": "ì„ì‹œì €ì¥(ì´ˆì•ˆ) ìƒì„±. `date`ëŠ” **YYYY-MM-DD** ë¬¸ìì—´ì´ì–´ì•¼ í•¨.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/DraftCreate" } }
          }
        },
        "responses": {
          "201": {
            "description": "ì´ˆì•ˆ ìƒì„± ì„±ê³µ",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [{ "$ref": "#/components/schemas/SuccessEnvelope" }],
                  "properties": { "data": { "$ref": "#/components/schemas/Draft" } }
                }
              }
            }
          },
          "401": {
            "description": "UNAUTHORIZED",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "422": {
            "description": "VALIDATION_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "403": {
            "description": "FORBIDDEN (RLS)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "500": {
            "description": "INTERNAL_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          }
        }
      }
    },
    "/drafts/latest": {
      "get": {
        "tags": ["Drafts"],
        "summary": "Get latest draft",
        "description": "ë³¸ì¸ ê¸°ì¤€ ìµœì‹  ì„ì‹œì €ì¥ 1ê±´ ë°˜í™˜. ì—†ìœ¼ë©´ `data: null`.",
        "responses": {
          "200": {
            "description": "ì¡°íšŒ ì„±ê³µ",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [{ "$ref": "#/components/schemas/SuccessEnvelope" }],
                  "properties": {
                    "data": {
                      "oneOf": [{ "$ref": "#/components/schemas/Draft" }, { "type": "null" }]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "UNAUTHORIZED",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "403": {
            "description": "FORBIDDEN (RLS)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "500": {
            "description": "INTERNAL_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          }
        }
      }
    },
    "/drafts/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Draft ID (uuid)"
        }
      ],
      "get": {
        "tags": ["Drafts"],
        "summary": "Get a single draft (by id)",
        "description": "ë³¸ì¸ ì†Œìœ , `status='draft'`, `deleted_at IS NULL` ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì´ˆì•ˆ 1ê±´ ì¡°íšŒ.",
        "responses": {
          "200": {
            "description": "ì¡°íšŒ ì„±ê³µ",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [{ "$ref": "#/components/schemas/SuccessEnvelope" }],
                  "properties": { "data": { "$ref": "#/components/schemas/Draft" } }
                }
              }
            }
          },
          "401": {
            "description": "UNAUTHORIZED",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "403": {
            "description": "FORBIDDEN (RLS)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "404": {
            "description": "NOT_FOUND (ì¡°ê±´ ë¶ˆì¼ì¹˜)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "500": {
            "description": "INTERNAL_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          }
        }
      },
      "patch": {
        "tags": ["Drafts"],
        "summary": "Update a draft",
        "description": "ì„ì‹œì €ì¥ ì¼ë¶€ ìˆ˜ì •. bodyëŠ” ë¶€ë¶„ í•„ë“œë§Œ í¬í•¨ ê°€ëŠ¥.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/DraftUpdate" } }
          }
        },
        "responses": {
          "200": {
            "description": "ìˆ˜ì • ì„±ê³µ",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [{ "$ref": "#/components/schemas/SuccessEnvelope" }],
                  "properties": { "data": { "$ref": "#/components/schemas/Draft" } }
                }
              }
            }
          },
          "400": {
            "description": "BAD_REQUEST (id í˜•ì‹ ì˜¤ë¥˜ ë“±)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "401": {
            "description": "UNAUTHORIZED",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "403": {
            "description": "FORBIDDEN (RLS)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "404": {
            "description": "NOT_FOUND (ì¡°ê±´ ë¶ˆì¼ì¹˜)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "422": {
            "description": "VALIDATION_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "500": {
            "description": "INTERNAL_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          }
        }
      },
      "delete": {
        "tags": ["Drafts"],
        "summary": "Soft delete a draft",
        "description": "`deleted_at` íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ê°±ì‹ í•˜ëŠ” ì†Œí”„íŠ¸ ì‚­ì œ.",
        "responses": {
          "204": { "description": "ì‚­ì œ ì„±ê³µ (ë³¸ë¬¸ ì—†ìŒ)" },
          "401": {
            "description": "UNAUTHORIZED",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "403": {
            "description": "FORBIDDEN (RLS)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "404": {
            "description": "NOT_FOUND (ì¡°ê±´ ë¶ˆì¼ì¹˜)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "500": {
            "description": "INTERNAL_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          }
        }
      }
    },
    "/drafts/{id}/publish": {
      "post": {
        "tags": ["Drafts"],
        "summary": "Publish a draft",
        "description": "ì´ˆì•ˆì„ ê²Œì‹œ ìƒíƒœ(`published`)ë¡œ ì „í™˜. í•˜ë£¨ 1ê²Œì‹œ ì œí•œ(ê°™ì€ user_id+date published ìœ ë‹ˆí¬)ì— ê±¸ë¦¬ë©´ 409.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "uuid" }
          }
        ],
        "responses": {
          "200": {
            "description": "ê²Œì‹œ ì„±ê³µ",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [{ "$ref": "#/components/schemas/SuccessEnvelope" }],
                  "properties": { "data": { "$ref": "#/components/schemas/PublishResult" } }
                }
              }
            }
          },
          "401": {
            "description": "UNAUTHORIZED",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "403": {
            "description": "FORBIDDEN (RLS)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "404": {
            "description": "NOT_FOUND (draft ì—†ìŒ)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "409": {
            "description": "DAILY_LIMIT (ìœ ë‹ˆí¬ ì¶©ëŒ)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          },
          "500": {
            "description": "INTERNAL_ERROR",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/ErrorEnvelope" } }
            }
          }
        }
      }
    }
  }
}
